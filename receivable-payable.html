<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>养殖管理系统 - 应收应付管理</title>
    <script src="./assets/3.4.17.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2E7D32',
                        secondary: '#1976D2',
                        success: '#2E7D32',
                        warning: '#F57F17',
                        danger: '#D32F2F',
                        surface: '#f8fafc',
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans SC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            background-color: #f1f5f9; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-h-screen; 
            font-family: 'Noto Sans SC', sans-serif; 
        }
        
        .iphone-canvas {
            width: 375px;
            height: 812px;
            background: #ffffff;
            position: relative;
            overflow: hidden;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
            border: 8px solid #1e293b;
        }
        
        .hide-scroll::-webkit-scrollbar { display: none; }
        .glass-header { backdrop-filter: blur(10px); background: rgba(255,255,255,0.8); }
        .tab-active { 
            color: #2E7D32; 
            border-bottom: 2px solid #2E7D32; 
            font-weight: 600;
        }
        .nav-item.active { 
            color: #2E7D32; 
        }
        
        /* 状态标签样式 */
        .status-tag {
            padding: 0.1rem 0.5rem;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 500;
        }
        .status-wait {
            background-color: rgba(25, 118, 210, 0.1);
            color: #1976D2;
        }
        .status-done {
            background-color: rgba(46, 125, 50, 0.1);
            color: #2E7D32;
        }
        .status-overdue {
            background-color: rgba(211, 47, 47, 0.1);
            color: #D32F2F;
        }
        .row-overdue {
            background-color: #fef2f2 !important;
        }
        
        /* 核销页面样式 */
        .verify-page {
            z-index: 100;
        }
        
        /* 详情弹窗样式 */
        .detail-modal {
            z-index: 90;
        }
    </style>
</head>
<body>
    <div class="iphone-canvas flex flex-col">
        <!-- 顶部状态栏 -->
        <header class="glass-header sticky top-0 z-10 px-6 pt-12 pb-4 flex justify-between items-center border-b border-slate-50">
            <button class="text-slate-800" onclick="goBackToHome()">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
            </button>
             <div class="flex flex-1 items-center gap-2 ml-2">
                <h1 class="text-lg font-bold text-slate-800">应收应付管理</h1>
            </div>
        </header>

        <!-- 应收应付标签切换 -->
        <div class="flex border-b border-slate-100 overflow-x-auto hide-scroll">
            <button id="receivableTab" class="flex-1 py-3 text-sm tab-active whitespace-nowrap" onclick="switchTab(1)">
                应收账款
            </button>
            <button id="payableTab" class="flex-1 py-3 text-sm text-slate-500 whitespace-nowrap" onclick="switchTab(2)">
                应付账款
            </button>
        </div>

        <!-- 主内容区 -->
        <main class="flex-1 overflow-y-auto hide-scroll pb-24 px-6">
            <!-- 汇总卡片 -->
            <div class="grid grid-cols-4 gap-2 mt-6 mb-4 text-center text-sm">
                <div class="bg-white p-3 rounded-lg shadow-sm">
                    <div class="text-gray-500">总额</div>
                    <div class="font-bold" id="totalAmount">¥16500</div>
                </div>
                <div class="bg-white p-3 rounded-lg shadow-sm">
                    <div class="text-gray-500">已核销</div>
                    <div class="font-bold" id="verifiedAmount">¥6000</div>
                </div>
                <div class="bg-white p-3 rounded-lg shadow-sm">
                    <div class="text-gray-500">未核销</div>
                    <div class="font-bold" id="unverifiedAmount">¥10500</div>
                </div>
                <div class="bg-white p-3 rounded-lg shadow-sm">
                    <div class="text-gray-500">逾期</div>
                    <div class="font-bold text-red-600" id="overdueAmount">¥4500</div>
                </div>
            </div>

            <!-- 应收账款列表 -->
            <div id="receivableList" class="space-y-2">
                <!-- 逾期记录 -->
                <div class="bg-white rounded-lg p-3 shadow-sm row-overdue cursor-pointer" onclick="showDetail(1,1)">
                    <div class="flex justify-between text-sm mb-1">
                        <span>超市采购（王老板）</span>
                        <span class="font-bold text-danger">-¥4500</span>
                    </div>
                    <div class="text-xs text-gray-500 mb-2">欠款：2026-02-10｜约定：2026-02-25｜逾期7天</div>
                    <div class="flex justify-between items-center">
                        <span class="status-tag status-overdue">逾期</span>
                        <button class="bg-secondary text-white text-xs px-3 py-1 rounded" onclick="event.stopPropagation(); goVerify(1,1)">核销</button>
                    </div>
                </div>

                <!-- 待回款记录 -->
                <div class="bg-white rounded-lg p-3 shadow-sm cursor-pointer" onclick="showDetail(1,2)">
                    <div class="flex justify-between text-sm mb-1">
                        <span>批发经销商</span>
                        <span class="font-bold text-danger">-¥6000</span>
                    </div>
                    <div class="text-xs text-gray-500 mb-2">欠款：2026-02-20｜约定：2026-03-05｜逾期0天</div>
                    <div class="flex justify-between items-center">
                        <span class="status-tag status-wait">待回款</span>
                        <button class="bg-secondary text-white text-xs px-3 py-1 rounded" onclick="event.stopPropagation(); goVerify(1,2)">核销</button>
                    </div>
                </div>

                <!-- 已回款记录 -->
                <div class="bg-white rounded-lg p-3 shadow-sm cursor-pointer" onclick="showDetail(1,3)">
                    <div class="flex justify-between text-sm mb-1">
                        <span>农贸市场（李老板）</span>
                        <span class="font-bold text-danger">-¥6000</span>
                    </div>
                    <div class="text-xs text-gray-500 mb-2">欠款：2026-01-15｜约定：2026-02-15｜逾期0天</div>
                    <div class="flex justify-between items-center">
                        <span class="status-tag status-done">已回款</span>
                        <button class="bg-gray-400 text-white text-xs px-3 py-1 rounded" disabled>已核销</button>
                    </div>
                </div>
            </div>

            <!-- 应付账款列表 -->
            <div id="payableList" class="space-y-2 hidden">
                <!-- 待付款记录 -->
                <div class="bg-white rounded-lg p-3 shadow-sm cursor-pointer" onclick="showDetail(2,1)">
                    <div class="flex justify-between text-sm mb-1">
                        <span>饲料供应商（正大）</span>
                        <span class="font-bold text-secondary">¥5200</span>
                    </div>
                    <div class="text-xs text-gray-500 mb-2">欠款：2026-02-18｜约定：2026-03-10｜逾期0天</div>
                    <div class="flex justify-between items-center">
                        <span class="status-tag status-wait">待付款</span>
                        <button class="bg-secondary text-white text-xs px-3 py-1 rounded" onclick="event.stopPropagation(); goVerify(2,1)">核销</button>
                    </div>
                </div>

                <!-- 逾期记录 -->
                <div class="bg-white rounded-lg p-3 shadow-sm row-overdue cursor-pointer" onclick="showDetail(2,2)">
                    <div class="flex justify-between text-sm mb-1">
                        <span>疫苗供应商（科前生物）</span>
                        <span class="font-bold text-secondary">¥3800</span>
                    </div>
                    <div class="text-xs text-gray-500 mb-2">欠款：2026-01-20｜约定：2026-02-20｜逾期7天</div>
                    <div class="flex justify-between items-center">
                        <span class="status-tag status-overdue">逾期</span>
                        <button class="bg-secondary text-white text-xs px-3 py-1 rounded" onclick="event.stopPropagation(); goVerify(2,2)">核销</button>
                    </div>
                </div>

                <!-- 已付款记录 -->
                <div class="bg-white rounded-lg p-3 shadow-sm cursor-pointer" onclick="showDetail(2,3)">
                    <div class="flex justify-between text-sm mb-1">
                        <span>水电公司</span>
                        <span class="font-bold text-secondary">¥1200</span>
                    </div>
                    <div class="text-xs text-gray-500 mb-2">欠款：2026-02-01｜约定：2026-02-28｜逾期0天</div>
                    <div class="flex justify-between items-center">
                        <span class="status-tag status-done">已付款</span>
                        <button class="bg-gray-400 text-white text-xs px-3 py-1 rounded" disabled>已核销</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- 详情弹窗 -->
        <div id="detailModal" class="fixed inset-0 bg-black/50 detail-modal flex items-center justify-center z-80 hidden">
            <div class="bg-white rounded-3xl p-6 w-80 max-h-[80vh] overflow-y-auto">
                <h2 class="text-lg font-bold text-slate-800 mb-4" id="detailTitle">应收账款详情</h2>
                
                <div class="space-y-3 text-sm mb-4" id="detailContent">
                    <!-- 内容将通过JS动态填充 -->
                </div>
                
                <div class="flex gap-3 mt-4">
                    <button class="flex-1 py-2 border border-slate-200 rounded-lg text-sm text-slate-600 hover:bg-slate-50 transition-colors" onclick="closeDetailModal()">
                        关闭
                    </button>
                    <button id="detailVerifyBtn" class="flex-1 py-2 bg-secondary text-white rounded-lg text-sm hover:bg-secondary/90 transition-colors">
                        核销
                    </button>
                </div>
            </div>
        </div>

        <!-- 核销页面（默认隐藏） -->
        <div id="verifyPage" class="fixed inset-0 bg-white verify-page hidden">
            <div class="max-w-xl mx-auto p-4 h-full flex flex-col">
                <div class="py-4 flex justify-between items-center">
                    <button onclick="backToList()" class="text-gray-600">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </button>
                    <h2 id="verifyTitle" class="text-lg font-bold">回款核销</h2>
                    <div></div>
                </div>

                <div class="bg-gray-50 p-3 rounded-lg mb-4 text-sm">
                    <div class="mb-1" id="verifyParty">欠款方：超市采购（王老板）</div>
                    <div class="mb-1" id="verifyTotalAmount">应收金额：<span class="font-bold">¥4500</span></div>
                    <div id="verifyRemainingAmount">未核销：<span class="font-bold text-red-600">¥4500</span></div>
                </div>

                <div class="space-y-4 flex-1 overflow-y-auto pb-20">
                    <div>
                        <label class="text-sm text-gray-600 block mb-1">核销日期</label>
                        <input type="date" id="verifyDate" class="w-full border border-gray-200 rounded-lg p-2 text-sm" value="">
                    </div>
                    <div>
                        <label class="text-sm text-gray-600 block mb-1">核销金额</label>
                        <input type="number" id="verifyAmount" placeholder="可部分核销" class="w-full border border-gray-200 rounded-lg p-2 text-sm" value="">
                        <p class="text-xs text-gray-500 mt-1" id="verifyAmountTip">可输入小于总额的金额，剩余金额将继续挂账</p>
                    </div>
                    <div>
                        <label class="text-sm text-gray-600 block mb-1">核销方式</label>
                        <select id="verifyMethod" class="w-full border border-gray-200 rounded-lg p-2 text-sm">
                            <option>微信</option>
                            <option>支付宝</option>
                            <option>银行转账</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-sm text-gray-600 block mb-1">凭证上传 <span class="text-red-600">*</span></label>
                        <div id="uploadArea" class="border border-gray-200 rounded-lg p-4 text-center text-sm text-gray-500 cursor-pointer hover:border-secondary transition-colors">
                            <i data-lucide="upload" class="w-5 h-5 mx-auto mb-1"></i>
                            <p>点击上传回款/付款凭证</p>
                            <p class="text-xs mt-1">必传，支持截图、PDF、收据</p>
                        </div>
                        <input type="file" id="voucherUpload" accept="image/*,.pdf" class="hidden" onchange="handleFileUpload()">
                        <div id="uploadedFiles" class="mt-2 space-y-2 hidden">
                            <!-- 已上传文件列表 -->
                        </div>
                    </div>
                </div>

                <div class="fixed bottom-10 left-0 right-0 flex gap-3 px-4 max-w-xl mx-auto">
                    <button class="flex-1 py-3 border border-gray-200 rounded-lg text-sm" onclick="backToList()">取消</button>
                    <button class="flex-1 py-3 bg-secondary text-white rounded-lg text-sm" onclick="doVerify()">确认核销</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentTab = 1;
        let currentVerifyType = 1; // 1=应收，2=应付
        let currentVerifyId = 1;
        let fileUploaded = false;

        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            
            // 初始化日期
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('verifyDate').value = today;
            
            // 设置上传区域点击事件
            document.getElementById('uploadArea').addEventListener('click', function() {
                document.getElementById('voucherUpload').click();
            });
            
            // 设置按钮点击事件
            document.getElementById('btn-settings').addEventListener('click', () => {
                alert('正在跳转至设置页面...\n包含：密码修改、手动备份、账号管理');
            });
        });

        // 返回首页
        function goBackToHome() {
            window.location.href = 'index.html';
        }

        // 切换应收/应付标签
        function switchTab(n) {
            currentTab = n;
            
            // 更新标签样式
            document.getElementById('receivableTab').classList.remove('tab-active');
            document.getElementById('payableTab').classList.remove('tab-active');
            document.getElementById('receivableTab').classList.add('text-slate-500');
            document.getElementById('payableTab').classList.add('text-slate-500');
            
            // 切换列表显示
            document.getElementById('receivableList').classList.add('hidden');
            document.getElementById('payableList').classList.add('hidden');
            
            if (n === 1) {
                document.getElementById('receivableTab').classList.add('tab-active');
                document.getElementById('receivableTab').classList.remove('text-slate-500');
                document.getElementById('receivableList').classList.remove('hidden');
                
                // 更新汇总数据（应收账款）
                document.getElementById('totalAmount').textContent = '¥16500';
                document.getElementById('verifiedAmount').textContent = '¥6000';
                document.getElementById('unverifiedAmount').textContent = '¥10500';
                document.getElementById('overdueAmount').textContent = '¥4500';
            } else {
                document.getElementById('payableTab').classList.add('tab-active');
                document.getElementById('payableTab').classList.remove('text-slate-500');
                document.getElementById('payableList').classList.remove('hidden');
                
                // 更新汇总数据（应付账款）
                document.getElementById('totalAmount').textContent = '¥10200';
                document.getElementById('verifiedAmount').textContent = '¥1200';
                document.getElementById('unverifiedAmount').textContent = '¥9000';
                document.getElementById('overdueAmount').textContent = '¥3800';
            }
        }

        // 显示详情弹窗
        function showDetail(type, id) {
            const modal = document.getElementById('detailModal');
            const title = document.getElementById('detailTitle');
            const content = document.getElementById('detailContent');
            const verifyBtn = document.getElementById('detailVerifyBtn');
            
            // 设置标题
            if (type === 1) {
                title.textContent = '应收账款详情';
                verifyBtn.textContent = '回款核销';
                verifyBtn.onclick = function() {
                    closeDetailModal();
                    goVerify(1, id);
                };
            } else {
                title.textContent = '应付账款详情';
                verifyBtn.textContent = '付款核销';
                verifyBtn.onclick = function() {
                    closeDetailModal();
                    goVerify(2, id);
                };
            }
            
            // 填充详情内容
            if (type === 1 && id === 1) {
                // 应收账款-逾期
                content.innerHTML = `
                    <div class="flex justify-between">
                        <span class="text-slate-500">欠款方：</span>
                        <span class="font-medium">超市采购（王老板）</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">欠款金额：</span>
                        <span class="font-medium text-danger">-¥4500.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">欠款日期：</span>
                        <span class="font-medium">2026-02-10</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">约定回款日期：</span>
                        <span class="font-medium">2026-02-25</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">逾期天数：</span>
                        <span class="font-medium text-danger">7天</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">回款状态：</span>
                        <span class="font-medium">
                            <span class="status-tag status-overdue">逾期</span>
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">未核销金额：</span>
                        <span class="font-medium text-danger">¥4500.00</span>
                    </div>
                    <div class="flex justify-between items-start">
                        <span class="text-slate-500">备注：</span>
                        <span class="font-medium text-right">春节前鸡蛋采购款，约定月底结清</span>
                    </div>
                    <div class="pt-2 border-t border-slate-100">
                        <span class="text-slate-500 block mb-1">相关凭证：</span>
                        <div class="flex gap-2">
                            <div class="w-16 h-16 bg-slate-100 rounded-lg overflow-hidden">
                                <img src="https://picsum.photos/80/80?random=1" alt="凭证图片" class="w-full h-full object-cover">
                            </div>
                            <div class="w-16 h-16 bg-slate-100 rounded-lg overflow-hidden">
                                <img src="https://picsum.photos/80/80?random=2" alt="凭证图片" class="w-full h-full object-cover">
                            </div>
                        </div>
                    </div>
                `;
            } else if (type === 1 && id === 2) {
                // 应收账款-待回款
                content.innerHTML = `
                    <div class="flex justify-between">
                        <span class="text-slate-500">欠款方：</span>
                        <span class="font-medium">批发经销商</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">欠款金额：</span>
                        <span class="font-medium text-danger">-¥6000.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">欠款日期：</span>
                        <span class="font-medium">2026-02-20</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">约定回款日期：</span>
                        <span class="font-medium">2026-03-05</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">逾期天数：</span>
                        <span class="font-medium">0天</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">回款状态：</span>
                        <span class="font-medium">
                            <span class="status-tag status-wait">待回款</span>
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">未核销金额：</span>
                        <span class="font-medium text-danger">¥6000.00</span>
                    </div>
                    <div class="flex justify-between items-start">
                        <span class="text-slate-500">备注：</span>
                        <span class="font-medium text-right">批量鸡蛋采购，月结客户</span>
                    </div>
                `;
            } else if (type === 2 && id === 1) {
                // 应付账款-待付款
                content.innerHTML = `
                    <div class="flex justify-between">
                        <span class="text-slate-500">收款方：</span>
                        <span class="font-medium">饲料供应商（正大）</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">应付金额：</span>
                        <span class="font-medium text-secondary">¥5200.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">欠款日期：</span>
                        <span class="font-medium">2026-02-18</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">约定付款日期：</span>
                        <span class="font-medium">2026-03-10</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">逾期天数：</span>
                        <span class="font-medium">0天</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">付款状态：</span>
                        <span class="font-medium">
                            <span class="status-tag status-wait">待付款</span>
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">未核销金额：</span>
                        <span class="font-medium text-danger">¥5200.00</span>
                    </div>
                    <div class="flex justify-between items-start">
                        <span class="text-slate-500">备注：</span>
                        <span class="font-medium text-right">2月份饲料采购款，月结30天</span>
                    </div>
                `;
            } else if (type === 2 && id === 2) {
                // 应付账款-逾期
                content.innerHTML = `
                    <div class="flex justify-between">
                        <span class="text-slate-500">收款方：</span>
                        <span class="font-medium">疫苗供应商（科前生物）</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">应付金额：</span>
                        <span class="font-medium text-secondary">¥3800.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">欠款日期：</span>
                        <span class="font-medium">2026-01-20</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">约定付款日期：</span>
                        <span class="font-medium">2026-02-20</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">逾期天数：</span>
                        <span class="font-medium text-danger">7天</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">付款状态：</span>
                        <span class="font-medium">
                            <span class="status-tag status-overdue">逾期</span>
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-500">未核销金额：</span>
                        <span class="font-medium text-danger">¥3800.00</span>
                    </div>
                    <div class="flex justify-between items-start">
                        <span class="text-slate-500">备注：</span>
                        <span class="font-medium text-right">禽流感疫苗采购，财务忘记付款</span>
                    </div>
                `;
            }
            
            // 显示弹窗
            modal.classList.remove('hidden');
        }

        // 关闭详情弹窗
        function closeDetailModal() {
            document.getElementById('detailModal').classList.add('hidden');
        }

        // 进入核销页面
        function goVerify(type, id) {
            currentVerifyType = type;
            currentVerifyId = id;
            
            const verifyPage = document.getElementById('verifyPage');
            const verifyTitle = document.getElementById('verifyTitle');
            const verifyParty = document.getElementById('verifyParty');
            const verifyTotalAmount = document.getElementById('verifyTotalAmount');
            const verifyRemainingAmount = document.getElementById('verifyRemainingAmount');
            
            // 设置核销页面标题和基础信息
            if (type === 1) {
                // 应收账款核销
                verifyTitle.textContent = '回款核销';
                
                if (id === 1) {
                    verifyParty.textContent = '欠款方：超市采购（王老板）';
                    verifyTotalAmount.innerHTML = '应收金额：<span class="font-bold">¥4500</span>';
                    verifyRemainingAmount.innerHTML = '未核销：<span class="font-bold text-red-600">¥4500</span>';
                    document.getElementById('verifyAmount').value = 4500;
                } else if (id === 2) {
                    verifyParty.textContent = '欠款方：批发经销商';
                    verifyTotalAmount.innerHTML = '应收金额：<span class="font-bold">¥6000</span>';
                    verifyRemainingAmount.innerHTML = '未核销：<span class="font-bold text-red-600">¥6000</span>';
                    document.getElementById('verifyAmount').value = 6000;
                }
            } else {
                // 应付账款核销
                verifyTitle.textContent = '付款核销';
                
                if (id === 1) {
                    verifyParty.textContent = '收款方：饲料供应商（正大）';
                    verifyTotalAmount.innerHTML = '应付金额：<span class="font-bold">¥5200</span>';
                    verifyRemainingAmount.innerHTML = '未核销：<span class="font-bold text-red-600">¥5200</span>';
                    document.getElementById('verifyAmount').value = 5200;
                } else if (id === 2) {
                    verifyParty.textContent = '收款方：疫苗供应商（科前生物）';
                    verifyTotalAmount.innerHTML = '应付金额：<span class="font-bold">¥3800</span>';
                    verifyRemainingAmount.innerHTML = '未核销：<span class="font-bold text-red-600">¥3800</span>';
                    document.getElementById('verifyAmount').value = 3800;
                }
            }
            
            // 初始化核销日期为当天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('verifyDate').value = today;
            
            // 重置文件上传状态
            fileUploaded = false;
            document.getElementById('uploadedFiles').classList.add('hidden');
            document.getElementById('voucherUpload').value = '';
            
            // 显示核销页面
            verifyPage.classList.remove('hidden');
        }

        // 返回列表页面
        function backToList() {
            document.getElementById('verifyPage').classList.add('hidden');
        }

        // 处理文件上传
        function handleFileUpload() {
            const files = document.getElementById('voucherUpload').files;
            if (files.length > 0) {
                fileUploaded = true;
                const uploadedFiles = document.getElementById('uploadedFiles');
                uploadedFiles.classList.remove('hidden');
                
                // 清空原有内容
                uploadedFiles.innerHTML = '';
                
                // 显示已上传文件
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const fileItem = document.createElement('div');
                    fileItem.className = 'flex items-center gap-2 bg-slate-50 p-2 rounded-lg';
                    fileItem.innerHTML = `
                        <i data-lucide="file-text" class="w-4 h-4 text-secondary"></i>
                        <span class="text-xs flex-1 truncate">${file.name}</span>
                        <span class="text-xs text-slate-500">${formatFileSize(file.size)}</span>
                    `;
                    uploadedFiles.appendChild(fileItem);
                }
            }
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        // 执行核销操作
        function doVerify() {
            // 验证必填项
            const verifyAmount = parseFloat(document.getElementById('verifyAmount').value);
            if (!verifyAmount || verifyAmount <= 0) {
                alert('请输入有效的核销金额');
                return;
            }
            
            // 验证文件上传
            if (!fileUploaded) {
                alert('请上传回款/付款凭证（截图、收据等）');
                return;
            }
            
            // 获取核销总额
            const totalAmountText = document.getElementById('verifyTotalAmount').querySelector('span').textContent;
            const totalAmount = parseFloat(totalAmountText.replace('¥', ''));
            
            // 验证核销金额不能超过总额
            if (verifyAmount > totalAmount) {
                alert('核销金额不能超过应收/应付总额');
                return;
            }
            
            // 计算剩余金额
            const remainingAmount = totalAmount - verifyAmount;
            
            // 核销成功提示
            let successMsg = '';
            if (remainingAmount === 0) {
                successMsg = '核销成功！该款项已全部核销完成，状态已更新为已回款/已付款，并同步至收支台账。';
            } else {
                successMsg = `核销成功！本次核销¥${verifyAmount}，剩余¥${remainingAmount}将继续挂账，状态已更新并同步至收支台账。`;
            }
            
            alert(successMsg);
            
            // 返回列表页面
            backToList();
            
            // 这里可以添加更新列表数据的逻辑
            // 例如：更新对应记录的状态、金额等
        }
    </script>
</body>
</html>