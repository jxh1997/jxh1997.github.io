<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">博客详情 | 荆学辉的个人主页</title>
  <!-- SEO 元标签：动态填充 -->
  <meta name="description" id="page-description" content="">
  <meta name="keywords" id="page-keywords" content="">
  <!-- 外部资源：集成 MD 渲染和代码高亮库 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
  <link rel="stylesheet" href="/assets/css/css2.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <!-- 核心库：修复 highlight.js 引入顺序和路径 -->
  <!-- 1. 先加载 highlight.js 核心库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
  <!-- 2. 再加载常用语言包（确保代码高亮支持更多语言） -->
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/html.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/css.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>
  <!-- 3. 最后加载 Markdown 渲染库 -->
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.1/lib/marked.umd.min.js"></script>

  <!-- Tailwind 配置：与列表页保持一致 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#FF7D00',
            light: '#F5F7FA',
            dark: '#1D2939'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
            serif: ['Georgia', 'Cambria', 'serif']
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      /* 博客内容样式：优化排版 */
      .blog-content {
        @apply font-serif text-gray-700 leading-relaxed;
      }
      /* 代码块容器样式：确保背景色、内边距、边框可见 */
      .blog-content pre {
        @apply my-4 p-4 bg-gray-900 text-gray-100 rounded-lg overflow-x-auto;
        @apply shadow-md; /* 新增阴影，增强视觉区分 */
      }

      /* 行内代码样式：与代码块区分开 */
      .blog-content code {
        @apply font-mono text-sm bg-gray-100 px-1 py-0.5 rounded;
        @apply text-gray-800; /* 确保行内代码文字颜色清晰 */
      }

      /* 代码块内的代码样式：继承容器样式，避免冲突 */
      .blog-content pre code {
        @apply bg-transparent px-0 py-0 rounded-none;
        @apply text-gray-100; /* 确保代码块内文字与背景对比明显 */
      }
      .blog-content h1 {
        @apply text-3xl font-bold mt-10 mb-6 text-dark border-b border-gray-200 pb-2;
      }
      .blog-content h2 {
        @apply text-2xl font-bold mt-8 mb-4 text-dark border-b border-gray-200 pb-2;
      }
      .blog-content h3 {
        @apply text-xl font-bold mt-6 mb-3 text-dark;
      }
      .blog-content p {
        @apply mb-4;
      }
      .blog-content img {
        @apply max-w-full h-auto my-6 rounded-lg shadow-sm mx-auto;
      }
      .blog-content a {
        @apply text-primary hover:underline;
      }
      .blog-content ul, .blog-content ol {
        @apply mb-4 pl-6;
      }
      .blog-content ul {
        @apply list-disc;
      }
      .blog-content ol {
        @apply list-decimal;
      }
      .blog-content blockquote {
        @apply border-l-4 border-primary pl-4 italic my-4 text-gray-600 bg-primary/5 p-3 rounded-r;
      }
      .blog-content pre {
        @apply my-4 p-4 bg-gray-900 text-gray-100 rounded-lg overflow-x-auto;
      }
      .blog-content code {
        @apply font-mono text-sm bg-gray-100 px-1 py-0.5 rounded;
      }
      .blog-content table {
        @apply w-full border-collapse my-6;
      }
      .blog-content th, .blog-content td {
        @apply border border-gray-300 px-4 py-2 text-sm;
      }
      .blog-content th {
        @apply bg-gray-50 font-semibold;
      }
      /* 加载中样式 */
      .loader {
        width: 48px;
        height: 48px;
        border: 5px solid #165DFF;
        border-bottom-color: transparent;
        border-radius: 50%;
        animation: rotation 1s linear infinite;
      }
      @keyframes rotation {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      /* 图片加载失败样式 */
      .blog-cover-fallback {
        @apply bg-gray-100 flex items-center justify-center text-gray-400 h-64 md:h-96;
      }
    }
  </style>
</head>

<body class="font-inter bg-light text-dark antialiased">
  <!-- 导航栏：保留原有占位符 -->
  <header id="navbar-placeholder"></header>

  <!-- 博客详情区：优化布局，增加返回按钮 -->
  <section class="py-20 bg-white">
    <div class="container mx-auto px-4 md:px-6">
      <!-- 返回列表按钮：新增 -->
      <div class="mb-8">
        <a href="/blog.html" class="inline-flex items-center text-gray-600 hover:text-primary transition-colors">
          <i class="fa fa-arrow-left mr-2"></i>
          <span>返回博客列表</span>
        </a>
      </div>

      <div class="flex flex-col lg:flex-row gap-8 lg:gap-10">
        <!-- 主内容区：优化移动端显示 -->
        <div class="lg:w-2/3">
          <!-- 加载状态 -->
          <div id="loader-container" class="flex justify-center py-16">
            <div id="loader" class="loader"></div>
          </div>

          <!-- 错误状态：优化提示样式 -->
          <div id="error-state" class="py-16 text-center hidden">
            <i class="fa fa-exclamation-triangle text-5xl text-yellow-500 mb-4"></i>
            <p class="text-gray-600 mb-4">文章加载失败</p>
            <div class="flex flex-col sm:flex-row justify-center gap-3">
              <button id="retry-btn"
                class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                重试
              </button>
              <a href="/blog.html"
                class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                返回列表
              </a>
            </div>
          </div>

          <!-- 博客内容（加载成功后显示） -->
          <article id="blog-content-container" class="hidden">
            <!-- 博客标题区：优化移动端排版 -->
            <div class="mb-6 md:mb-8">
              <span id="blog-category"
                class="inline-block px-3 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full mb-3"></span>
              <h1 id="blog-title" class="text-[clamp(1.5rem,3vw,2.2rem)] font-bold mb-4"></h1>
              <div class="flex flex-wrap items-center gap-3 text-gray-500 text-sm">
                <div class="flex items-center">
                  <img src="/assets/images/avatar.jpg" alt="作者头像" class="w-7 h-7 rounded-full mr-2">
                  <span>荆学辉</span>
                </div>
                <time id="blog-publish-date" datetime=""></time>
                <span id="blog-views"><i class="fa fa-eye mr-1"></i></span>
                <span id="blog-read-time"><i class="fa fa-clock-o mr-1"></i></span>
              </div>
            </div>

            <!-- 博客封面图：增加加载失败降级 -->
            <div class="mb-6 md:mb-8">
              <img id="blog-cover" src="" alt="" class="w-full h-auto rounded-xl shadow-sm"
                onError="this.classList.add('hidden'); this.nextElementSibling.classList.remove('hidden')">
              <div id="cover-fallback" class="blog-cover-fallback hidden">
                <i class="fa fa-image text-4xl"></i>
              </div>
            </div>

            <!-- 博客正文：MD 内容渲染容器 -->
            <div id="blog-content" class="blog-content mb-8 md:mb-10"></div>

            <!-- 标签：优化样式 -->
            <div class="flex flex-wrap gap-2 mb-8 md:mb-10 pt-4 border-t border-gray-200">
              <span class="text-gray-500 text-sm">标签：</span>
              <div id="blog-tags"></div>
            </div>

            <!-- 分享：优化移动端显示 -->
            <div class="flex flex-wrap items-center gap-3 mb-8 md:mb-12 pt-6 border-t border-gray-200">
              <span class="text-gray-500">分享：</span>
              <a href="#"
                class="w-9 h-9 rounded-full bg-[#1DA1F2]/10 text-[#1DA1F2] flex items-center justify-center hover:bg-[#1DA1F2]/20 transition-colors"
                title="分享到Twitter">
                <i class="fa fa-twitter"></i>
              </a>
              <a href="#"
                class="w-9 h-9 rounded-full bg-[#4267B2]/10 text-[#4267B2] flex items-center justify-center hover:bg-[#4267B2]/20 transition-colors"
                title="分享到Facebook">
                <i class="fa fa-facebook"></i>
              </a>
              <a href="#"
                class="w-9 h-9 rounded-full bg-[#25D366]/10 text-[#25D366] flex items-center justify-center hover:bg-[#25D366]/20 transition-colors"
                title="分享到WhatsApp">
                <i class="fa fa-whatsapp"></i>
              </a>
              <a href="#"
                class="w-9 h-9 rounded-full bg-[#333]/10 text-[#333] flex items-center justify-center hover:bg-[#333]/20 transition-colors"
                title="复制链接" id="copy-link-btn">
                <i class="fa fa-link"></i>
              </a>
              <!-- 复制链接提示：隐藏状态 -->
              <span id="copy-success" class="text-green-500 text-sm hidden">链接已复制！</span>
            </div>

            <!-- 上一篇/下一篇：优化移动端布局 -->
            <div
              class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 pt-8 border-t border-gray-200">
              <div id="prev-blog" class="w-full md:w-[45%]">
                <!-- 上一篇文章链接 -->
              </div>
              <div id="next-blog" class="w-full md:w-[45%] text-right">
                <!-- 下一篇文章链接 -->
              </div>
            </div>
          </article>
        </div>

        <!-- 侧边栏：优化移动端显示（堆叠排列） -->
        <div class="lg:w-1/3">
          <!-- 作者信息：保留原有样式 -->
          <div class="bg-light rounded-xl p-5 mb-6">
            <div class="flex items-center gap-4 mb-4">
              <img src="/assets/images/avatar.jpg" alt="荆学辉" class="w-14 h-14 rounded-full object-cover">
              <div>
                <h3 class="font-semibold text-lg">荆学辉</h3>
                <p class="text-gray-500 text-sm">全栈开发工程师</p>
              </div>
            </div>
            <p class="text-gray-600 text-sm mb-4">
              专注于前后端技术开发与架构设计，热衷于分享技术心得与实战经验。
            </p>
            <div class="flex gap-3">
              <a href="#" class="text-gray-500 hover:text-primary transition-colors" title="GitHub"><i
                  class="fa fa-github text-xl"></i></a>
              <a href="#" class="text-gray-500 hover:text-primary transition-colors" title="LinkedIn"><i
                  class="fa fa-linkedin text-xl"></i></a>
              <a href="#" class="text-gray-500 hover:text-primary transition-colors" title="Twitter"><i
                  class="fa fa-twitter text-xl"></i></a>
              <a href="#" class="text-gray-500 hover:text-primary transition-colors" title="CodePen"><i
                  class="fa fa-codepen text-xl"></i></a>
            </div>
          </div>

          <!-- 相关文章：优化样式 -->
          <div class="bg-light rounded-xl p-5 mb-6">
            <h3 class="font-semibold text-lg mb-4 flex items-center">
              <i class="fa fa-files-o text-primary mr-2"></i>相关文章
            </h3>
            <div id="related-blogs" class="space-y-3">
              <!-- 相关文章将由JS填充 -->
            </div>
          </div>

          <!-- 热门标签：优化样式 -->
          <div class="bg-light rounded-xl p-5">
            <h3 class="font-semibold text-lg mb-4 flex items-center">
              <i class="fa fa-tags text-primary mr-2"></i>热门标签
            </h3>
            <div id="popular-tags" class="flex flex-wrap gap-2">
              <!-- 热门标签将由JS填充 -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 页脚：保留原有占位符 -->
  <footer id="footer-placeholder"></footer>

  <!-- 返回顶部按钮：保留原有功能 -->
  <button id="back-to-top"
    class="fixed bottom-8 right-8 w-12 h-12 rounded-full bg-primary text-white shadow-lg flex items-center justify-center opacity-0 invisible transition-all z-50">
    <i class="fa fa-arrow-up"></i>
  </button>

  <!-- 核心库：仅保留 MD 渲染和代码高亮（删除 gray-matter 引入） -->
  <script src="https://cdn.jsdelivr.net/npm/marked@12.0.1/lib/marked.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>

  <!-- 基础组件脚本：调整路径 -->
  <script src="/assets/js/utils.js"></script>
  <script src="/assets/js/components/nav.js"></script>
  <script src="/assets/js/load-components.js"></script>
  <script src="/assets/js/components/scroll.js"></script>

  <!-- 博客详情脚本：核心修正（集成自定义 Front Matter 解析） -->
  <script>
    // 全局状态：存储博客元数据和当前文章信息
    const state = {
      allBlogs: [], // 所有博客元数据
      currentBlog: null, // 当前博客信息
      metaLoaded: false // 元数据是否加载完成
    };

    // DOM 元素缓存
    const loaderContainer = document.getElementById('loader-container');
    const errorState = document.getElementById('error-state');
    const blogContentContainer = document.getElementById('blog-content-container');
    const retryBtn = document.getElementById('retry-btn');
    const copyLinkBtn = document.getElementById('copy-link-btn');
    const copySuccess = document.getElementById('copy-success');

    // -------------------------- 新增：自定义 Front Matter 解析函数 --------------------------
    function parseFrontMatter(mdContent) {
      const lines = mdContent.split('\n');
      const data = {};
      let content = '';
      let inFrontMatter = false;
      let frontMatterEndIndex = -1;

      // 1. 检查 Front Matter 开头（---）
      if (lines.length > 0 && lines[0].trim() === '---') {
        inFrontMatter = true;

        // 2. 查找 Front Matter 结束位置（---）
        for (let i = 1; i < lines.length; i++) {
          if (lines[i].trim() === '---') {
            inFrontMatter = false;
            frontMatterEndIndex = i;
            break;
          }

          // 3. 解析键值对（支持字符串、数字、布尔值、数组）
          const line = lines[i].trim();
          if (line && !line.startsWith('#')) { // 忽略注释
            const colonIndex = line.indexOf(':');
            if (colonIndex > 0) {
              const key = line.substring(0, colonIndex).trim();
              let value = line.substring(colonIndex + 1).trim();

              // 处理数组（如 tags: [前端, 性能优化]）
              if (value.startsWith('[') && value.endsWith(']')) {
                value = value.slice(1, -1).split(',').map(item => item.trim());
              }
              // 处理字符串（如 title: "性能优化实战"）
              else if (value.startsWith('"') && value.endsWith('"')) {
                value = value.slice(1, -1);
              }
              // 处理布尔值
              else if (value === 'true') {
                value = true;
              } else if (value === 'false') {
                value = false;
              }
              // 处理数字
              else if (!isNaN(value)) {
                value = Number(value);
              }

              data[key] = value;
            }
          }
        }
      }

      // 4. 提取正文内容（Front Matter 之后的部分）
      if (frontMatterEndIndex !== -1) {
        content = lines.slice(frontMatterEndIndex + 1).join('\n').trim();
      } else {
        content = mdContent.trim(); // 无 Front Matter 时，全部作为正文
      }

      return { data: data, content: content }; // 与原 gray-matter 返回格式兼容
    }
    // -------------------------- 自定义解析函数结束 --------------------------

    // 1. 从URL获取博客标识（支持ID或Slug）
    function getBlogIdentifier() {
      const params = new URLSearchParams(window.location.search);
      // 优先从查询参数获取（兼容原有逻辑）
      const paramIdentifier = params.get('id') || params.get('slug');
      if (paramIdentifier) return paramIdentifier;

      // 新增：从URL路径中提取slug（适配静态路径格式，如 /性能优化.html）
      try {
        const pathname = window.location.pathname;
        const pathSegments = pathname.split('/');
        const fileName = pathSegments[pathSegments.length - 1]; // 取最后一段（如 "性能优化.html"）
        const slug = fileName.replace(/\.html$/, ''); // 去除 .html 后缀
        if (slug && slug !== '') return decodeURIComponent(slug); // 解码URL编码的中文（如 %E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96 → 性能优化）
      } catch (error) {
        console.error('从路径提取slug失败：', error);
      }

      return '';
    }

    // 2. 加载博客元数据（blogs.json）
    async function loadBlogMetadata() {
      try {
        const response = await fetch('/data/blog-meta.json');
        if (!response.ok) {
          throw new Error(`元数据请求失败：${response.status}（请检查 /data/blog-meta.json 路径是否正确）`);
        }
        state.allBlogs = await response.json();
        state.metaLoaded = true;
        return true;
      } catch (error) {
        console.error('加载博客元数据失败：', error);
        state.metaLoaded = false;
        return false;
      }
    }

    // 3. 加载并解析 Markdown 文章内容（核心逻辑：使用自定义解析函数）
    async function loadBlogContent() {
      const identifier = getBlogIdentifier();
      
      if (!identifier) {
        showError('未指定博客文章（无法从URL提取slug或id）');
        return;
      }

      try {
        // 显示加载中
        loaderContainer.classList.remove('hidden');
        errorState.classList.add('hidden');
        blogContentContainer.classList.add('hidden');

        // 先加载元数据（blog-meta.json）
        if (!state.metaLoaded && !(await loadBlogMetadata())) {
          throw new Error('无法加载博客元数据（/data/blog-meta.json 不存在或格式错误）');
        }

        // 查找当前博客的元数据（匹配 id 或 slug）
        const blogMeta = state.allBlogs.find(blog =>
          blog.id?.toString() === identifier || blog.slug === identifier
        );
        if (!blogMeta) {
          throw new Error(`未找到该博客文章（在 blog-meta.json 中未匹配到 slug: ${identifier} 或 id: ${identifier}）`);
        }

        state.currentBlog = blogMeta;

        // 构建 MD 文件路径（如 _posts/2024-08-26-性能优化.md）
        const mdFileName = blogMeta.fileName || `${blogMeta.publishDate.split('T')[0]}-${blogMeta.slug}.md`;
        const mdFileUrl = `/_posts/${mdFileName}`; // 确保 _posts 目录在网站根目录下

        // 加载 MD 文件
        const mdResponse = await fetch(mdFileUrl);
        if (!mdResponse.ok) {
          throw new Error(`MD 文件请求失败：${mdResponse.status}（路径：${mdFileUrl} 不存在）`);
        }
        const mdContent = await mdResponse.text();

        // 使用自定义函数解析 Front Matter
        const { data: frontMatter, content: mdBody } = parseFrontMatter(mdContent);
        // 合并元数据（Front Matter 优先级高于 blog-meta.json）
        const blogData = { ...blogMeta, ...frontMatter };

        // 渲染博客内容
        renderBlogContent(blogData, mdBody);

        // 渲染相关组件（相关文章、热门标签、上一篇/下一篇）
        renderRelatedBlogs();
        renderPopularTags();
        renderPrevNextBlogs();

        // 更新UI：显示内容，隐藏加载
        loaderContainer.classList.add('hidden');
        blogContentContainer.classList.remove('hidden');

      } catch (error) {
        console.error('加载博客内容失败：', error);
        showError(error.message || '加载失败，请稍后重试');
      }
    }

    // 4. 渲染博客正文内容（原有逻辑不变）
    function renderBlogContent(blogData, mdBody) {
      // 更新页面标题和SEO元标签
      const pageTitle = `${blogData.title} | 荆学辉的个人主页`;
      const pageDesc = blogData.excerpt || mdBody.slice(0, 160); // 从正文取摘要（无excerpt时）
      const pageKeywords = blogData.tags ? blogData.tags.join(',') : '技术博客,前端开发,后端开发';

      document.getElementById('page-title').textContent = pageTitle;
      document.getElementById('page-description').setAttribute('content', pageDesc);
      document.getElementById('page-keywords').setAttribute('content', pageKeywords);

      // 填充博客基本信息
      document.getElementById('blog-category').textContent = getCategoryName(blogData.category);
      document.getElementById('blog-title').textContent = blogData.title;
      document.getElementById('blog-publish-date').innerHTML =
        `<i class="fa fa-calendar-o mr-1"></i>${formatDate(blogData.publishDate || blogData.date)}`;
      document.getElementById('blog-views').textContent += ` ${blogData.views || 1}`;
      document.getElementById('blog-read-time').textContent += ` ${calculateReadTime(mdBody)}`;
      
      // 封面图（处理路径：如果是相对路径，补充根路径）
      const coverImage = blogData.coverImage 
        ? (blogData.coverImage.startsWith('/') ? blogData.coverImage : `/${blogData.coverImage}`)
        : '/assets/images/blog-covers/default.jpg';
      document.getElementById('blog-cover').src = coverImage;
      document.getElementById('blog-cover').alt = blogData.title || '博客封面';

      // 渲染 MD 正文（开启代码高亮）
      marked.setOptions({
        highlight: (code, lang) => {
          // 修复：处理无语言指定的代码块（默认使用 plaintext）
          if (lang && hljs.getLanguage(lang)) {
            return hljs.highlight(code, { language: lang }).value;
          }
          // 无语言时，使用 plaintext 避免高亮失败
          return hljs.highlight(code, { language: 'plaintext' }).value;
        },
        breaks: true, // 支持换行符
        gfm: true, // 支持 GitHub Flavored Markdown（必须开启，否则代码块不生效）
        // 新增：明确代码块渲染规则（确保生成 <pre><code> 标签）
        langPrefix: 'language-', // 为 <code> 标签添加 language-xxx 类，便于 highlight.js 识别
        pedantic: false, // 禁用严格的 Markdown 语法检查，兼容更多代码块格式
      });

      // 渲染 MD 内容到页面
      const blogContentEl = document.getElementById('blog-content');
      blogContentEl.innerHTML = marked.parse(mdBody);

      // 关键步骤：手动触发 highlight.js 对动态生成的代码块进行高亮
      hljs.highlightAll(); // 这行是核心，确保代码块样式生效

      // 渲染标签
      const tagsContainer = document.getElementById('blog-tags');
      tagsContainer.innerHTML = '';
      if (blogData.tags && blogData.tags.length > 0) {
        blogData.tags.forEach(tag => {
          const tagEl = document.createElement('a');
          tagEl.href = `/blog.html?tag=${encodeURIComponent(tag)}`;
          tagEl.className = 'px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded hover:bg-gray-300 transition-colors';
          tagEl.textContent = tag;
          tagsContainer.appendChild(tagEl);
        });
      } else {
        tagsContainer.innerHTML = '<span class="text-gray-400 text-xs">无标签</span>';
      }
    }

    // 5. 渲染相关文章（原有逻辑不变）
    function renderRelatedBlogs() {
      const relatedContainer = document.getElementById('related-blogs');
      relatedContainer.innerHTML = '';
      if (!state.currentBlog) return;

      // 筛选同分类的相关文章（最多3篇，排除当前文章）
      const relatedBlogs = state.allBlogs
        .filter(blog => blog.category === state.currentBlog.category && blog.id !== state.currentBlog.id)
        .sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate))
        .slice(0, 3);

      if (relatedBlogs.length === 0) {
        relatedContainer.innerHTML = '<p class="text-gray-500 text-sm">暂无相关文章</p>';
        return;
      }

      relatedBlogs.forEach(blog => {
        const blogEl = document.createElement('a');
        const detailUrl = blog.slug ? `./${blog.slug}.html` : `../blog-detail.html?id=${blog.id}`;
        blogEl.href = detailUrl;
        blogEl.className = 'flex gap-3 group';
        blogEl.innerHTML = `
          <img src="${blog.coverImage || '/assets/images/blog-covers/default.jpg'}" 
               alt="${blog.title}" 
               class="w-18 h-18 object-cover rounded-lg flex-shrink-0">
          <div>
            <h4 class="text-sm font-medium group-hover:text-primary transition-colors line-clamp-2">${blog.title}</h4>
            <p class="text-gray-500 text-xs mt-1">${formatDate(blog.publishDate)}</p>
          </div>
        `;
        relatedContainer.appendChild(blogEl);
      });
    }

    // 6. 渲染热门标签（原有逻辑不变）
    function renderPopularTags() {
      const tagsContainer = document.getElementById('popular-tags');
      tagsContainer.innerHTML = '';
      if (state.allBlogs.length === 0) return;

      // 统计标签出现次数
      const tagCount = {};
      state.allBlogs.forEach(blog => {
        blog.tags && blog.tags.forEach(tag => {
          tagCount[tag] = (tagCount[tag] || 0) + 1;
        });
      });

      // 按次数排序，取前10个标签
      const sortedTags = Object.entries(tagCount)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);

      sortedTags.forEach(([tag, count]) => {
        const tagEl = document.createElement('a');
        tagEl.href = `/blog.html?tag=${encodeURIComponent(tag)}`;
        const sizeClass = count > 5 ? 'text-sm px-3 py-1.5' : count > 2 ? 'text-xs px-3 py-1' : 'text-xs px-2 py-1';
        tagEl.className = `${sizeClass} bg-gray-200 text-gray-700 rounded hover:bg-primary hover:text-white transition-colors`;
        tagEl.textContent = tag;
        tagsContainer.appendChild(tagEl);
      });
    }

    // 7. 渲染上一篇/下一篇（原有逻辑不变）
    function renderPrevNextBlogs() {
      if (!state.currentBlog || state.allBlogs.length <= 1) return;

      // 按发布日期排序（最新在前）
      const sortedBlogs = [...state.allBlogs].sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
      const currentIndex = sortedBlogs.findIndex(blog => blog.id === state.currentBlog.id || blog.slug === state.currentBlog.slug);

      // 上一篇（更早的文章）
      const prevContainer = document.getElementById('prev-blog');
      if (currentIndex < sortedBlogs.length - 1) {
        const prevBlog = sortedBlogs[currentIndex + 1];
        const prevUrl = prevBlog.slug ? `./${prevBlog.slug}.html` : `../blog-detail.html?id=${prevBlog.id}`;
        prevContainer.innerHTML = `
          <p class="text-gray-500 text-sm mb-1">上一篇</p>
          <a href="${prevUrl}" class="text-sm hover:text-primary transition-colors line-clamp-1">
            <i class="fa fa-angle-left mr-1"></i>${prevBlog.title}
          </a>
        `;
      } else {
        prevContainer.innerHTML = '<p class="text-gray-400 text-sm">没有更多文章</p>';
      }

      // 下一篇（更新的文章）
      const nextContainer = document.getElementById('next-blog');
      if (currentIndex > 0) {
        const nextBlog = sortedBlogs[currentIndex - 1];
        const nextUrl = nextBlog.slug ? `./${nextBlog.slug}.html` : `../blog-detail.html?id=${nextBlog.id}`;
        nextContainer.innerHTML = `
          <p class="text-gray-500 text-sm mb-1">下一篇</p>
          <a href="${nextUrl}" class="text-sm hover:text-primary transition-colors line-clamp-1">
            ${nextBlog.title}<i class="fa fa-angle-right ml-1"></i>
          </a>
        `;
      } else {
        nextContainer.innerHTML = '<p class="text-gray-400 text-sm">没有更多文章</p>';
      }
    }

    // 辅助函数：格式化日期
    function formatDate(dateString) {
      console.log(2222, dateString);
      
      return new Date(dateString).toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    }

    // 辅助函数：估算阅读时间（每分钟300字）
    function calculateReadTime(content) {
      const wordCount = content.replace(/\s+/g, '').length;
      const minutes = Math.ceil(wordCount / 300);
      return `${minutes} 分钟阅读`;
    }

    // 辅助函数：获取分类中文名称
    function getCategoryName(category) {
      const categories = {
        'frontend': '前端开发',
        'backend': '后端开发',
        'devops': 'DevOps',
        'career': '职业发展'
      };
      return categories[category] || '未分类';
    }

    // 辅助函数：显示错误状态
    function showError(message) {
      loaderContainer.classList.add('hidden');
      errorState.classList.remove('hidden');
      errorState.querySelector('p').textContent = message;
    }

    // 辅助函数：复制当前页面链接
    function copyCurrentLink() {
      const currentUrl = window.location.href;
      navigator.clipboard.writeText(currentUrl)
        .then(() => {
          copySuccess.classList.remove('hidden');
          setTimeout(() => {
            copySuccess.classList.add('hidden');
          }, 2000);
        })
        .catch(err => {
          console.error('复制链接失败：', err);
          alert('复制失败，请手动复制链接');
        });
    }

    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', function () {
      // 加载博客内容
      loadBlogContent();

      // 重试按钮事件
      retryBtn.addEventListener('click', loadBlogContent);

      // 复制链接按钮事件
      copyLinkBtn.addEventListener('click', function (e) {
        e.preventDefault();
        copyCurrentLink();
      });

      // 平滑滚动功能：保留原有逻辑
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();

          // 关闭移动菜单
          const mobileMenu = document.getElementById('mobile-menu');
          const menuToggle = document.getElementById('menu-toggle');
          if (mobileMenu && menuToggle && !mobileMenu.classList.contains('hidden')) {
            mobileMenu.classList.add('hidden');
            const icon = menuToggle.querySelector('i');
            if (icon) {
              icon.classList.remove('fa-times');
              icon.classList.add('fa-bars');
            }
          }

          // 平滑滚动到目标位置
          const targetId = this.getAttribute('href');
          const targetElement = document.querySelector(targetId);
          if (targetElement) {
            window.scrollTo({
              top: targetElement.offsetTop - 80,
              behavior: 'smooth'
            });
          }
        });
      });
    });
  </script>

  <script src="/assets/js/main.js"></script>
</body>
</html>